<div class="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 p-4">
  <!-- JOIN PHASE -->
  <div *ngIf="gamePhase === 'join'" class="max-w-md mx-auto mt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-8">
      <div class="text-center mb-6">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">üéÆ Kahoot Game</h1>
        <p class="text-gray-600">Modo Equipos</p>
      </div>

      <div class="space-y-4">
        <!-- Game Code -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">C√≥digo del Juego</label>
          <input 
            type="text" 
            [(ngModel)]="gameId" 
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center text-2xl font-bold uppercase"
            placeholder="XXXXXX"
            maxlength="6"
          />
        </div>

        <!-- Team Selection -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Selecciona tu Equipo</label>
          <select 
            [(ngModel)]="selectedTeamId" 
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
          >
            <option value="">-- Selecciona un equipo --</option>
            <option *ngFor="let team of teams" [value]="team.id">
              {{ team.name }}
            </option>
          </select>
        </div>

        <!-- Join Button -->
        <button 
          (click)="joinGame()" 
          [disabled]="!gameId || !selectedTeamId || isLoading"
          class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-4 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ isLoading ? loadingMessage : 'Unirse al Juego' }}
        </button>
      </div>
    </div>
  </div>

  <!-- WAITING PHASE -->
  <div *ngIf="gamePhase === 'waiting'" class="max-w-4xl mx-auto mt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-8 text-center">
      <div class="mb-6">
        <div class="animate-pulse text-6xl mb-4">‚è≥</div>
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Esperando a que comience el juego...</h2>
        <p class="text-gray-600">C√≥digo del juego: <span class="font-bold text-2xl text-blue-600">{{ gameId }}</span></p>
      </div>

      <!-- Participants -->
      <div class="mb-6">
        <h3 class="text-xl font-semibold mb-4">Participantes ({{ participants.length }})</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div *ngFor="let participant of participants" class="bg-gray-100 rounded-lg p-3">
            <div class="text-2xl mb-1">üë§</div>
            <div class="font-semibold text-sm">{{ participant.userName }}</div>
            <div class="text-xs text-gray-600">{{ participant.teamName }}</div>
          </div>
        </div>
      </div>

      <!-- Start Button (Admin only) -->
      <button 
        *ngIf="isAdmin"
        (click)="startGame()" 
        [disabled]="isLoading || participants.length < 2"
        class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-8 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ isLoading ? loadingMessage : 'üöÄ Iniciar Juego' }}
      </button>
      
      <p *ngIf="isAdmin && participants.length < 2" class="text-sm text-gray-500 mt-2">
        Se necesitan al menos 2 participantes para comenzar
      </p>
    </div>
  </div>

  <!-- PLAYING PHASE -->
  <div *ngIf="gamePhase === 'playing'" class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-lg p-4 mb-4 flex items-center justify-between">
      <div>
        <h2 class="text-xl font-bold text-gray-800">Kahoot Game</h2>
        <p class="text-sm text-gray-600">C√≥digo: {{ gameId }}</p>
      </div>
      
      <!-- Progress -->
      <div class="flex items-center space-x-4">
        <div class="text-right">
          <div class="text-sm text-gray-600">Progreso</div>
          <div class="font-bold text-lg">{{ questionsAnswered }} / {{ totalQuestions }}</div>
        </div>
        <div class="w-48 bg-gray-200 rounded-full h-3">
          <div 
            class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500"
            [style.width.%]="getProgressPercentage()"
          ></div>
        </div>
      </div>

      <button 
        (click)="exitGame()"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors"
      >
        Salir
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- Main Game Area -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-lg p-8">
          <div *ngIf="currentQuestion">
            <!-- Timer Circle -->
            <div class="flex justify-center mb-6">
              <div class="relative w-32 h-32">
                <svg class="transform -rotate-90 w-32 h-32">
                  <circle 
                    cx="64" 
                    cy="64" 
                    r="56" 
                    stroke="#e5e7eb" 
                    stroke-width="8" 
                    fill="transparent"
                  />
                  <circle 
                    cx="64" 
                    cy="64" 
                    r="56" 
                    [attr.stroke]="getTimerColor()" 
                    stroke-width="8" 
                    fill="transparent"
                    [style.stroke-dasharray]="351.86"
                    [style.stroke-dashoffset]="351.86 * (1 - timerProgress / 100)"
                    class="transition-all duration-1000"
                  />
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span class="text-3xl font-bold" [style.color]="getTimerColor()">
                    {{ timeRemaining }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Question Info -->
            <div class="flex items-center justify-center space-x-3 mb-6">
              <span 
                [class]="'px-3 py-1 rounded-full text-white text-sm font-semibold ' + getDifficultyBadgeClass()"
              >
                {{ currentQuestion.difficulty }}
              </span>
              <span class="text-gray-600 text-sm">{{ currentQuestion.category }}</span>
            </div>

            <!-- Question Text -->
            <h3 class="text-2xl font-bold text-gray-800 text-center mb-8">
              {{ currentQuestion.question }}
            </h3>

            <!-- Options Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div 
                *ngFor="let option of currentQuestion.options; let i = index"
                [class]="getOptionClass(i)"
                (click)="selectAnswer(i)"
              >
                <div class="flex items-center justify-between">
                  <span class="flex-1">{{ option }}</span>
                  <span *ngIf="hasAnswered && answerResult && i === answerResult.correctAnswer" class="text-2xl">‚úì</span>
                  <span *ngIf="hasAnswered && answerResult && i === selectedAnswer && !answerResult.isCorrect" class="text-2xl">‚úó</span>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
              <button 
                *ngIf="!hasAnswered"
                (click)="submitAnswer()" 
                [disabled]="selectedAnswer === null || isLoading"
                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-12 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {{ isLoading ? '‚è≥ Enviando...' : '‚úì Enviar Respuesta' }}
              </button>

              <!-- Answer Feedback -->
              <div *ngIf="hasAnswered && answerResult" class="mt-4">
                <div *ngIf="answerResult.isCorrect" class="text-green-600 text-xl font-bold">
                  üéâ ¬°Respuesta Correcta! üéâ
                </div>
                <div *ngIf="!answerResult.isCorrect" class="text-red-600 text-xl font-bold">
                  ‚ùå Respuesta Incorrecta
                </div>
              </div>

              <!-- Next Question Button (Admin only) -->
              <button 
                *ngIf="isAdmin && hasAnswered"
                (click)="nextQuestion()" 
                [disabled]="isLoading"
                class="mt-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all disabled:opacity-50"
              >
                {{ isLoading ? loadingMessage : '‚û°Ô∏è Siguiente Pregunta' }}
              </button>
            </div>
          </div>

          <div *ngIf="!currentQuestion" class="text-center py-12">
            <div class="animate-spin text-6xl mb-4">‚è≥</div>
            <p class="text-gray-600 text-lg">Cargando pregunta...</p>
          </div>
        </div>
      </div>

      <!-- Leaderboard Sidebar -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-lg p-6 sticky top-4">
          <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">üèÜ Clasificaci√≥n</h3>
          
          <div class="space-y-3">
            <div 
              *ngFor="let entry of leaderboard; let i = index"
              class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 transition-all hover:scale-105"
              [class.border-2]="i < 3"
              [class.border-yellow-400]="i === 0"
              [class.border-gray-400]="i === 1"
              [class.border-orange-400]="i === 2"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <span class="text-2xl font-bold">{{ getRankMedal(entry.rank) }}</span>
                  <div>
                    <div class="font-semibold text-gray-800">{{ entry.userName }}</div>
                    <div class="text-sm text-gray-600">{{ entry.teamName }}</div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="text-xl font-bold text-blue-600">{{ entry.score }}</div>
                  <div class="text-xs text-gray-500">
                    {{ entry.correctAnswers }} / {{ entry.correctAnswers + entry.wrongAnswers }}
                  </div>
                </div>
              </div>
              
              <!-- Streak Indicator -->
              <div *ngIf="entry.streak > 0" class="mt-2 text-xs text-orange-600 font-semibold">
                üî• Racha: {{ entry.streak }}
              </div>
            </div>
          </div>

          <div *ngIf="leaderboard.length === 0" class="text-center text-gray-500 py-8">
            No hay datos de clasificaci√≥n a√∫n
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RESULTS PHASE -->
  <div *ngIf="gamePhase === 'results'" class="max-w-4xl mx-auto mt-20">
    <div class="bg-white rounded-2xl shadow-2xl p-8">
      <div class="text-center mb-8">
        <div class="text-6xl mb-4">üéâ</div>
        <h2 class="text-4xl font-bold text-gray-800 mb-2">¬°Juego Terminado!</h2>
        <p class="text-gray-600">Resultados Finales</p>
      </div>

      <!-- Podium -->
      <div *ngIf="leaderboard.length >= 3" class="flex items-end justify-center space-x-4 mb-8">
        <!-- 2nd Place -->
        <div class="text-center">
          <div class="bg-gray-400 rounded-t-lg px-6 py-8 mb-2">
            <div class="text-4xl mb-2">ü•à</div>
            <div class="font-bold text-white">{{ leaderboard[1].userName }}</div>
            <div class="text-sm text-white opacity-80">{{ leaderboard[1].teamName }}</div>
            <div class="text-2xl font-bold text-white mt-2">{{ leaderboard[1].score }}</div>
          </div>
          <div class="bg-gray-400 h-24 rounded-b-lg"></div>
        </div>

        <!-- 1st Place -->
        <div class="text-center">
          <div class="bg-yellow-400 rounded-t-lg px-8 py-10 mb-2">
            <div class="text-5xl mb-2">ü•á</div>
            <div class="font-bold text-white text-lg">{{ leaderboard[0].userName }}</div>
            <div class="text-sm text-white opacity-90">{{ leaderboard[0].teamName }}</div>
            <div class="text-3xl font-bold text-white mt-2">{{ leaderboard[0].score }}</div>
          </div>
          <div class="bg-yellow-400 h-32 rounded-b-lg"></div>
        </div>

        <!-- 3rd Place -->
        <div class="text-center">
          <div class="bg-orange-400 rounded-t-lg px-6 py-6 mb-2">
            <div class="text-3xl mb-2">ü•â</div>
            <div class="font-bold text-white">{{ leaderboard[2].userName }}</div>
            <div class="text-sm text-white opacity-80">{{ leaderboard[2].teamName }}</div>
            <div class="text-xl font-bold text-white mt-2">{{ leaderboard[2].score }}</div>
          </div>
          <div class="bg-orange-400 h-16 rounded-b-lg"></div>
        </div>
      </div>

      <!-- Full Leaderboard -->
      <div class="mb-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Clasificaci√≥n Completa</h3>
        <div class="space-y-2">
          <div 
            *ngFor="let entry of leaderboard"
            class="flex items-center justify-between bg-gray-50 rounded-lg p-4"
          >
            <div class="flex items-center space-x-4">
              <span class="text-xl font-bold w-12">{{ getRankMedal(entry.rank) }}</span>
              <div>
                <div class="font-semibold">{{ entry.userName }}</div>
                <div class="text-sm text-gray-600">{{ entry.teamName }}</div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-2xl font-bold text-blue-600">{{ entry.score }}</div>
              <div class="text-sm text-gray-600">
                {{ entry.correctAnswers }} correctas / {{ entry.wrongAnswers }} incorrectas
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-center space-x-4">
        <button 
          (click)="router.navigate(['/dashboard'])"
          class="bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all"
        >
          Volver al Dashboard
        </button>
      </div>
    </div>
  </div>
</div>
